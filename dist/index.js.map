{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { ref, inject, type Ref, type App, type Plugin, unref } from \"vue\";\n\n/**\n * Configuration options for creating an i18n instance.\n */\ninterface I18nOptions {\n\n    /**\n     * The initial locale to use.\n     */\n    locale: string;\n    /**\n     * The fallback locale when translation is missing.\n     */\n    fallbackLocale: string;\n\n    /**\n     * Messages object with translations for different locales.\n     */\n    messages: Record<string, any>;\n\n    /**\n     * Whether to warn on missing translations, defaults to true.\n     */\n    missingWarn?: boolean;\n\n    /**\n     * Whether to inject globally in the same way as Vue I18n, defaults to true.\n     */\n    globalInjection?: boolean;\n\n    /**\n     * The global name to use for the i18n instance when globally injected.\n     */\n    globalNamePrefix?: string;\n}\n\n/**\n * The main i18n instance interface providing translation and locale management.\n */\nexport interface I18nInstance {\n    /**\n     * Translates a key into the current locale's string, optionally interpolating parameters.\n     * @param key - The translation key\n     * @param params - Optional parameters for interpolation, can be a reactive Ref or plain object\n     * @returns The translated string\n     */\n    t: (\n        key: string,\n        params?: Ref<Record<string, any>> | Record<string, any>,\n    ) => string;\n    /**\n     * The current locale as a reactive Ref.\n     */\n    locale: Ref<string>;\n    /**\n     * Array of available locales in the messages object.\n     */\n    availableLocales: string[];\n    /**\n     * The messages object containing translations for all locales.\n     */\n    messages: Record<string, any>;\n    /**\n     * The fallback locale to use when translation is missing.\n     */\n    fallbackLocale: string;\n}\n\nconst I18nInjectionKey = Symbol(\"i18n\");\n\n/**\n * Recursively flattens nested message objects into a flat map with dot-notation keys.\n *\n * @param messages - The nested messages object to flatten\n * @param prefix - Optional prefix for building dot-notation keys (used internally for recursion)\n * @returns A Map where keys are dot-notation paths and values are the translation strings\n */\nfunction flattenMessages(messages: any, prefix = \"\"): Map<string, string> {\n    const result = new Map<string, string>();\n\n    for (const key in messages) {\n        const fullKey = prefix ? `${prefix}.${key}` : key;\n        const value = (messages as Record<string, any>)[key];\n\n        if (typeof value === \"string\") {\n            result.set(fullKey, value);\n        } else if (typeof value === \"object\" && value !== null) {\n            const nested = flattenMessages(value, fullKey);\n            for (const [nestedKey, nestedValue] of nested) {\n                result.set(nestedKey, nestedValue);\n            }\n        }\n    }\n\n    return result;\n}\n\n/**\n * Builds a translation reference map for a given locale's messages.\n *\n * @param messages - The messages object for a specific locale\n * @param _locale - The locale identifier (unused, kept for API consistency)\n * @returns A Map mapping translation keys to their translated strings\n */\nfunction buildTranslationRefs(\n    messages: any,\n    _locale: string,\n): Map<string, string> {\n    const flat = flattenMessages(messages);\n    const refs = new Map<string, string>();\n\n    for (const [key, value] of flat) {\n        refs.set(key, value);\n    }\n\n    return refs;\n}\n\n/**\n * Creates a new i18n instance with the provided options.\n *\n * @param options - Configuration options for the i18n instance\n * @returns An I18nInstance that also implements the Vue Plugin interface\n *\n * @example\n * ```ts\n * const i18n = createI18n({\n *   locale: 'en',\n *   fallbackLocale: 'en',\n *   messages: {\n *     en: { greeting: 'Hello {name}!' },\n *     fr: { greeting: 'Bonjour {name}!' }\n *     'zh-CN': { greeting: '你好 {name}！' }\n *   }\n * })\n *\n * app.use(i18n)\n * ```\n */\nexport function createI18n(options: I18nOptions): I18nInstance & Plugin {\n    const locale = ref(options.locale);\n    const messages = options.messages;\n    const fallbackLocale = options.fallbackLocale;\n    const availableLocales = Object.keys(messages);\n    const translationRefs = new Map<string, Map<string, string>>();\n\n    // Build translation refs for all locales\n    for (const loc of availableLocales) {\n        if (!translationRefs.has(loc)) {\n            translationRefs.set(loc, buildTranslationRefs(messages[loc], loc));\n        }\n    }\n\n    function getTranslation(key: string): string {\n        // Try current locale\n        const currentRefs = translationRefs.get(locale.value);\n        const translation = currentRefs?.get(key);\n\n        if (translation !== undefined) {\n            return translation;\n        }\n\n        // Fallback to fallback locale\n        if (locale.value !== fallbackLocale) {\n            const fallbackRefs = translationRefs.get(fallbackLocale);\n            const fallbackTranslation = fallbackRefs?.get(key);\n\n            if (fallbackTranslation !== undefined) {\n                return fallbackTranslation;\n            }\n        }\n\n        // Missing translation\n        if (options.missingWarn !== false) {\n            console.warn(`[i18n] Missing translation for key: ${key}`);\n        }\n        return key;\n    }\n\n    const PARAM_REGEX = /\\{(\\w+)\\}/g;\n\n    function t(\n        key: string,\n        params?: Ref<Record<string, any>> | Record<string, any>,\n    ): string {\n        let translation = getTranslation(key);\n        if (!params) return translation;\n\n        const currentParams = unref(params);\n\n        translation = translation.replace(\n            PARAM_REGEX,\n            (match, paramName: string) => {\n                return paramName in currentParams\n                    ? String(currentParams[paramName])\n                    : match;\n            },\n        );\n\n        return translation;\n    }\n\n    // Global $t function for template usage (returns string)\n    function globalT(key: string, params?: any): string {\n        return t(key, params);\n    }\n\n    const instance: I18nInstance = {\n        t,\n        locale,\n        availableLocales,\n        messages: messages,\n        fallbackLocale,\n    };\n\n    const plugin: Plugin = {\n        install(app: App) {\n            app.provide(I18nInjectionKey, instance);\n            if (options.globalInjection !== false) {\n                if (options.globalNamePrefix?.length) {\n                    app.config.globalProperties[`$${options.globalNamePrefix}T`] = globalT;\n                    app.config.globalProperties[`$${options.globalNamePrefix}I18n`] = instance;\n                    app.config.globalProperties[`$${options.globalNamePrefix}Locale`] = locale;\n                }\n                else {\n                    app.config.globalProperties[`$t`] = globalT;\n                    app.config.globalProperties[`$i18n`] = instance;\n                    app.config.globalProperties[`$locale`] = locale;\n                }\n            }\n        },\n    };\n\n    return Object.assign(instance, plugin);\n}\n\n/**\n * Retrieves the i18n instance from the Vue injection context.\n *\n * @returns The I18nInstance provided by the nearest createI18n ancestor\n * @throws Error if called before the i18n plugin is installed via app.use()\n *\n * @example\n * ```ts\n * const { t, locale } = useI18n()\n * console.log(t('greeting', { name: 'World' }))\n * ```\n */\nexport function useI18n(): I18nInstance {\n    const i18n = inject<I18nInstance>(I18nInjectionKey);\n\n    if (!i18n) {\n        throw new Error(\n            \"I18n instance not found. Did you forget to install the i18n plugin?\",\n        );\n    }\n\n    return i18n;\n}\n"],"mappings":"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","names":["ref","inject","unref","I18nInjectionKey","flattenMessages","messages","prefix","result","key","fullKey","value","nested","nestedKey","nestedValue","buildTranslationRefs","_locale","flat","refs","createI18n","options","locale","fallbackLocale","availableLocales","translationRefs","loc","getTranslation","translation","fallbackTranslation","PARAM_REGEX","t","params","currentParams","match","paramName","globalT","instance","app","useI18n","i18n"]}