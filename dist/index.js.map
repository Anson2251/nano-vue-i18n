{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { ref, inject, type Ref, type App, type Plugin, unref } from \"vue\";\n\n/**\n * Configuration options for creating an i18n instance.\n */\ninterface I18nOptions {\n\n    /**\n     * The initial locale to use.\n     */\n    locale: string;\n    /**\n     * The fallback locale when translation is missing.\n     */\n    fallbackLocale: string;\n\n    /**\n     * Messages object with translations for different locales.\n     */\n    messages: Record<string, any>;\n\n    /**\n     * Whether to warn on missing translations, defaults to true.\n     */\n    missingWarn?: boolean;\n\n    /**\n     * Whether to inject globally in the same way as Vue I18n, defaults to true.\n     */\n    globalInject?: boolean;\n\n    /**\n     * The global name to use for the i18n instance when globally injected.\n     */\n    globalInjectPrefix?: string;\n}\n\n/**\n * The main i18n instance interface providing translation and locale management.\n */\nexport interface I18nInstance {\n    /**\n     * Translates a key into the current locale's string, optionally interpolating parameters.\n     * @param key - The translation key\n     * @param params - Optional parameters for interpolation, can be a reactive Ref or plain object\n     * @returns The translated string\n     */\n    t: (\n        key: string,\n        params?: Ref<Record<string, any>> | Record<string, any>,\n    ) => string;\n    /**\n     * The current locale as a reactive Ref.\n     */\n    locale: Ref<string>;\n    /**\n     * Array of available locales in the messages object.\n     */\n    availableLocales: string[];\n    /**\n     * The messages object containing translations for all locales.\n     */\n    messages: Record<string, any>;\n    /**\n     * The fallback locale to use when translation is missing.\n     */\n    fallbackLocale: string;\n}\n\nconst I18nInjectionKey = Symbol(\"i18n\");\n\n/**\n * Recursively flattens nested message objects into a flat map with dot-notation keys.\n *\n * @param messages - The nested messages object to flatten\n * @param prefix - Optional prefix for building dot-notation keys (used internally for recursion)\n * @returns A Map where keys are dot-notation paths and values are the translation strings\n */\nfunction flattenMessages(messages: Record<string, any>, prefix = \"\"): Map<string, string> {\n    const result = new Map<string, string>();\n\n    for (const key in messages) {\n        const fullKey = prefix ? `${prefix}.${key}` : key;\n        const value = messages[key];\n\n        if (typeof value === \"string\") {\n            result.set(fullKey, value);\n        }\n        else if (typeof value === \"object\" && value !== null) {\n            const nested = flattenMessages(value, fullKey);\n            for (const [nestedKey, nestedValue] of nested) {\n                result.set(nestedKey, nestedValue);\n            }\n        }\n    }\n\n    return result;\n}\n\n/**\n * Creates a new i18n instance with the provided options.\n *\n * @param options - Configuration options for the i18n instance\n * @returns An I18nInstance that also implements the Vue Plugin interface\n *\n * @example\n * ```ts\n * const i18n = createI18n({\n *   locale: 'en',\n *   fallbackLocale: 'en',\n *   messages: {\n *     en: { greeting: 'Hello {name}!' },\n *     fr: { greeting: 'Bonjour {name}!' }\n *     'zh-CN': { greeting: '你好 {name}！' }\n *   }\n * })\n *\n * app.use(i18n)\n * ```\n */\nexport function createI18n(options: I18nOptions): I18nInstance & Plugin {\n    const locale = ref(options.locale);\n    const messages = options.messages;\n    const fallbackLocale = options.fallbackLocale;\n    const availableLocales = Object.keys(messages);\n    const translationMap: Map<string, string> = flattenMessages(messages);\n\n    function getTranslation(key: string): string {\n        const translation = translationMap.get(`${locale.value}.${key}`)\n            ?? translationMap.get(`${fallbackLocale}.${key}`);\n\n        if (typeof translation !== \"undefined\") {\n            return translation;\n        }\n        else {\n            if (options.missingWarn !== false) {\n                console.warn(`[i18n (nano)] Missing translation for key: ${key}`);\n            }\n            return key;\n        }\n    }\n\n    const PARAM_REGEX = /\\{(\\w+)\\}/g;\n\n    function t(\n        key: string,\n        params?: Ref<Record<string, any>> | Record<string, any>,\n    ): string {\n        let translation = getTranslation(key);\n        if (!params) return translation;\n\n        const currentParams = unref(params);\n\n        translation = translation.replace(\n            PARAM_REGEX,\n            (match, paramName: string) => {\n                return paramName in currentParams\n                    ? String(currentParams[paramName])\n                    : match;\n            },\n        );\n\n        return translation;\n    }\n\n    const instance: I18nInstance = {\n        t,\n        locale,\n        availableLocales,\n        messages: messages,\n        fallbackLocale,\n    };\n\n    const plugin: Plugin = {\n        install(app: App) {\n            app.provide(I18nInjectionKey, instance);\n            if (options.globalInject !== false) {\n                if (options.globalInjectPrefix?.length) {\n                    app.config.globalProperties[`$${options.globalInjectPrefix}T`] = t;\n                    app.config.globalProperties[`$${options.globalInjectPrefix}I18n`] = instance;\n                    app.config.globalProperties[`$${options.globalInjectPrefix}Locale`] = locale;\n                }\n                else {\n                    app.config.globalProperties[`$t`] = t;\n                    app.config.globalProperties[`$i18n`] = instance;\n                    app.config.globalProperties[`$locale`] = locale;\n                }\n            }\n        },\n    };\n\n    return Object.assign(instance, plugin);\n}\n\n/**\n * Retrieves the i18n instance from the Vue injection context.\n *\n * @returns The I18nInstance provided by the nearest createI18n ancestor\n * @throws Error if called before the i18n plugin is installed via app.use()\n *\n * @example\n * ```ts\n * const { t, locale } = useI18n()\n * console.log(t('greeting', { name: 'World' }))\n * ```\n */\nexport function useI18n(): I18nInstance {\n    const i18n = inject<I18nInstance>(I18nInjectionKey);\n\n    if (!i18n) {\n        throw new Error(\n            \"I18n (nano) instance not found. Did you forget to install the i18n plugin?\",\n        );\n    }\n\n    return i18n;\n}\n"],"mappings":"AAAA,OAAS,OAAAA,EAAK,UAAAC,EAAyC,SAAAC,MAAa,MAqEpE,IAAMC,EAAmB,OAAO,MAAM,EAStC,SAASC,EAAgBC,EAA+BC,EAAS,GAAyB,CACtF,IAAMC,EAAS,IAAI,IAEnB,QAAWC,KAAOH,EAAU,CACxB,IAAMI,EAAUH,EAAS,GAAGA,CAAM,IAAIE,CAAG,GAAKA,EACxCE,EAAQL,EAASG,CAAG,EAE1B,GAAI,OAAOE,GAAU,SACjBH,EAAO,IAAIE,EAASC,CAAK,UAEpB,OAAOA,GAAU,UAAYA,IAAU,KAAM,CAClD,IAAMC,EAASP,EAAgBM,EAAOD,CAAO,EAC7C,OAAW,CAACG,EAAWC,CAAW,IAAKF,EACnCJ,EAAO,IAAIK,EAAWC,CAAW,CAEzC,CACJ,CAEA,OAAON,CACX,CAuBO,SAASO,EAAWC,EAA6C,CACpE,IAAMC,EAAShB,EAAIe,EAAQ,MAAM,EAC3BV,EAAWU,EAAQ,SACnBE,EAAiBF,EAAQ,eACzBG,EAAmB,OAAO,KAAKb,CAAQ,EACvCc,EAAsCf,EAAgBC,CAAQ,EAEpE,SAASe,EAAeZ,EAAqB,CACzC,IAAMa,EAAcF,EAAe,IAAI,GAAGH,EAAO,KAAK,IAAIR,CAAG,EAAE,GACxDW,EAAe,IAAI,GAAGF,CAAc,IAAIT,CAAG,EAAE,EAEpD,OAAI,OAAOa,EAAgB,IAChBA,GAGHN,EAAQ,cAAgB,IACxB,QAAQ,KAAK,8CAA8CP,CAAG,EAAE,EAE7DA,EAEf,CAEA,IAAMc,EAAc,aAEpB,SAASC,EACLf,EACAgB,EACM,CACN,IAAIH,EAAcD,EAAeZ,CAAG,EACpC,GAAI,CAACgB,EAAQ,OAAOH,EAEpB,IAAMI,EAAgBvB,EAAMsB,CAAM,EAElC,OAAAH,EAAcA,EAAY,QACtBC,EACA,CAACI,EAAOC,IACGA,KAAaF,EACd,OAAOA,EAAcE,CAAS,CAAC,EAC/BD,CAEd,EAEOL,CACX,CAEA,IAAMO,EAAyB,CAC3B,EAAAL,EACA,OAAAP,EACA,iBAAAE,EACA,SAAUb,EACV,eAAAY,CACJ,EAoBA,OAAO,OAAO,OAAOW,EAlBE,CACnB,QAAQC,EAAU,CACdA,EAAI,QAAQ1B,EAAkByB,CAAQ,EAClCb,EAAQ,eAAiB,KACrBA,EAAQ,oBAAoB,QAC5Bc,EAAI,OAAO,iBAAiB,IAAId,EAAQ,kBAAkB,GAAG,EAAIQ,EACjEM,EAAI,OAAO,iBAAiB,IAAId,EAAQ,kBAAkB,MAAM,EAAIa,EACpEC,EAAI,OAAO,iBAAiB,IAAId,EAAQ,kBAAkB,QAAQ,EAAIC,IAGtEa,EAAI,OAAO,iBAAiB,GAAQN,EACpCM,EAAI,OAAO,iBAAiB,MAAWD,EACvCC,EAAI,OAAO,iBAAiB,QAAab,GAGrD,CACJ,CAEqC,CACzC,CAcO,SAASc,GAAwB,CACpC,IAAMC,EAAO9B,EAAqBE,CAAgB,EAElD,GAAI,CAAC4B,EACD,MAAM,IAAI,MACN,4EACJ,EAGJ,OAAOA,CACX","names":["ref","inject","unref","I18nInjectionKey","flattenMessages","messages","prefix","result","key","fullKey","value","nested","nestedKey","nestedValue","createI18n","options","locale","fallbackLocale","availableLocales","translationMap","getTranslation","translation","PARAM_REGEX","t","params","currentParams","match","paramName","instance","app","useI18n","i18n"]}